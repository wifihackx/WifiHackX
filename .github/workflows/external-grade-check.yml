name: External Grade Check

on:
  schedule:
    # Ejecutar semanalmente los lunes a las 9:00 UTC
    - cron: '0 9 * * 1'
  workflow_dispatch:

jobs:
  external-validation:
    runs-on: ubuntu-latest
    env:
      EXTERNAL_HOST: white-caster-466401-g0.web.app
      EXTERNAL_URL: https://white-caster-466401-g0.web.app
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: npm
      
      - name: Install dependencies
        run: npm ci
      
      - name: Install Playwright browsers
        run: npx playwright install --with-deps chromium
      
      - name: External Grade Validation
        run: npm run validate:external
        env:
          EXTERNAL_HOST: ${{ env.EXTERNAL_HOST }}
          EXTERNAL_URL: ${{ env.EXTERNAL_URL }}
      
      - name: Upload validation results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: external-validation-results
          path: |
            external-validation-*.txt
            external-validation-*.json
          retention-days: 30
